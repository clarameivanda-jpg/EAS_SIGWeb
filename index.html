<!doctype html>
<html lang="id">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Kawasan Rawan Bencana Tsunami di Tempat Wisata Provinsi Bali</title>

    <!-- Vendor CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <!-- App CSS -->
    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <!-- HEADER -->
    <div class="header">
        <div class="brand">
            <div class="logo">ğŸŒŠ</div>
            <div>
                <div class="title">Kawasan Rawan Bencana Tsunami di Tempat Wisata Provinsi Bali</div>
                <div class="subtitle">WebGIS: KRB Tsunami â€¢ Tempat Pengungsian Darurat â€¢ Routing â€¢ Export</div>
            </div>
        </div>
        <div class="header-actions">
            <div class="lang-toggle" id="langToggle">
                <span class="lang-btn active" data-lang="id">ğŸ‡®ğŸ‡© ID</span>
                <span class="lang-btn" data-lang="en">ğŸ‡¬ğŸ‡§ EN</span>
            </div>
            <div class="pill" id="btnAbout"><i class="fa-solid fa-circle-info"></i> <span
                    data-i18n="about">Tentang</span></div>
            <div class="pill" id="btnHelp"><i class="fa-solid fa-life-ring"></i> <span data-i18n="help">Bantuan</span>
            </div>
        </div>
    </div>

    <!-- TOOLBAR -->
    <div class="toolbar">
        <div class="search">
            <input id="searchInput" class="input" placeholder="ğŸ” Cari TPD / wisata..." autocomplete="off" />
            <button class="btn light" id="btnSearch"><i class="fa-solid fa-magnifying-glass"></i></button>
            <div class="search-autocomplete" id="searchAutocomplete"></div>
        </div>

        <select class="select" id="routeProfile" title="Mode rute">
            <option value="foot" data-i18n="walking">ğŸš¶ Berjalan</option>
            <option value="car" data-i18n="driving">ğŸš— Naik Mobil</option>
        </select>

        <button class="btn green" id="btnCompute"><i class="fa-solid fa-route"></i> Hitung Rute</button>
        <button class="btn orange" id="btnNearest"><i class="fa-solid fa-bullseye"></i> Auto Terdekat</button>
        <button class="btn danger" id="btnEmergency"><i class="fa-solid fa-triangle-exclamation"></i> DARURAT</button>
        <button class="btn gray" id="btnReset"><i class="fa-solid fa-rotate-left"></i> Reset</button>
    </div>

    <div class="container">
        <!-- SIDEBAR -->
        <div class="sidebar" id="sidebar">
            <!-- TITIK AWAL -->
            <div class="panel">
                <h3><i class="fa-solid fa-location-crosshairs"></i> <span data-i18n="startPoint">Titik Awal</span></h3>

                <div class="field">
                    <label data-i18n="touristSpot">Objek Wisata</label>
                    <select id="selectWisata">
                        <option value="">-- pilih wisata --</option>
                    </select>
                </div>

                <div class="row">
                    <div class="field">
                        <label data-i18n="latitude">Lintang</label>
                        <input type="number" id="inputLat" step="0.000001" placeholder="-8.5">
                    </div>
                    <div class="field">
                        <label data-i18n="longitude">Bujur</label>
                        <input type="number" id="inputLon" step="0.000001" placeholder="115.0">
                    </div>
                </div>

                <div class="row" style="margin-top:10px;">
                    <button class="btn primary" id="btnPickStart" style="flex:1;"><i class="fa-solid fa-map-pin"></i>
                        <span data-i18n="setStart">Set Start / Cari TPD</span></button>
                    <button class="btn light" id="btnClearStart" style="flex:1;"><i class="fa-solid fa-xmark"></i>
                        <span data-i18n="clear">Bersihkan</span></button>
                </div>

                <small style="display:block;margin-top:10px;">Isi koordinat lalu klik tombol untuk melihat 10 TPD
                    terdekat, atau klik tombol tanpa koordinat untuk mode klik peta.</small>
            </div>

            <!-- TUJUAN -->
            <div class="panel">
                <h3><i class="fa-solid fa-flag-checkered"></i> <span data-i18n="destination">Tujuan</span></h3>

                <div class="field">
                    <label data-i18n="evacuationPoint">Titik Evakuasi</label>
                    <select id="selectEvakuasi">
                        <option value="">-- pilih evakuasi --</option>
                    </select>
                </div>
            </div>

            <!-- FILTER -->
            <div class="panel">
                <h3><i class="fa-solid fa-filter"></i> <span data-i18n="filter">Filter</span></h3>

                <div class="row">
                    <div class="field">
                        <label data-i18n="filterZone">Filter Zona</label>
                        <select id="filterKel">
                            <option value="ALL">Semua Zona</option>
                        </select>
                    </div>
                    <div class="field">
                        <label data-i18n="filterType">Filter Tipe</label>
                        <select id="filterTipe">
                            <option value="ALL">Semua Tipe</option>
                            <option value="pemerintahan">ğŸ›ï¸ Pemerintahan</option>
                            <option value="pendidikan">ğŸ« Pendidikan</option>
                            <option value="rumahsakit">ğŸ¥ Rumah Sakit</option>
                        </select>
                    </div>
                </div>

                <div class="field">
                    <label data-i18n="minElevation">Minimal Elevasi (m)</label>
                    <input type="number" id="filterMinElev" placeholder="contoh: 50" min="0" />
                </div>

                <div class="row" style="margin-top:10px;">
                    <button class="btn orange" id="btnApplyFilter" style="flex:1;"><i class="fa-solid fa-filter"></i>
                        <span data-i18n="apply">Terapkan</span></button>
                    <button class="btn light" id="btnClearFilter" style="flex:1;"><i class="fa-solid fa-eraser"></i>
                        <span data-i18n="clearFilter">Reset</span></button>
                </div>
            </div>

            <!-- STATISTIK -->
            <div class="panel">
                <h3><i class="fa-solid fa-chart-line"></i> <span data-i18n="statistics">Statistik</span></h3>
                <div class="grid">
                    <div class="stat">
                        <div class="val" id="statEv">0</div>
                        <div class="lbl" data-i18n="evacPoints">Titik Evakuasi</div>
                    </div>
                    <div class="stat">
                        <div class="val" id="statWi">0</div>
                        <div class="lbl" data-i18n="touristObjects">Objek Wisata</div>
                    </div>
                    <div class="stat">
                        <div class="val" id="statAvg">0</div>
                        <div class="lbl" data-i18n="avgElevation">Rata-rata Elevasi (m)</div>
                    </div>
                </div>
            </div>

            <!-- DOWNLOAD -->
            <div class="panel">
                <h3><i class="fa-solid fa-download"></i> Download</h3>
                <div class="row">
                    <button class="btn light" id="btnExportCSV" style="flex:1;"><i class="fa-solid fa-file-csv"></i>
                        CSV</button>
                    <button class="btn light" id="btnExportGeoJSON" style="flex:1;"><i class="fa-solid fa-code"></i>
                        GeoJSON</button>
                </div>
                <button class="btn light" id="btnPrint" style="width:100%;margin-top:10px;"><i
                        class="fa-solid fa-print"></i> Print Peta</button>
            </div>
        </div>

        <div class="toggle" id="toggleSidebar"><i class="fa-solid fa-chevron-left"></i></div>

        <!-- MAP -->
        <div id="map">
            <!-- COMPASS -->
            <div class="compass" id="compass">
                <div class="compass-needle">
                    <div class="compass-n">N</div>
                    <div class="compass-arrow"></div>
                </div>
            </div>

            <div class="map-float legend-box" id="legend">
                <div class="legend-header">
                    <i class="fa-solid fa-map-location-dot"></i> <span data-i18n="legend">Legenda</span>
                </div>
                <div class="legend-layers">
                    <!-- TPD Legend -->
                    <div id="legendTPD" class="legend-layer">
                        <div class="legend-layer-title" data-i18n="tpd">TPD</div>
                        <div class="legend-items">
                            <div class="legend-item" id="legendHijau"><span class="dot"
                                    style="background:#22c55e"></span> <span data-i18n="safe">Aman</span></div>
                            <div class="legend-item" id="legendKuning"><span class="dot"
                                    style="background:#eab308"></span> <span data-i18n="low">Rendah</span></div>
                            <div class="legend-item" id="legendMerah"><span class="dot"
                                    style="background:#dc2626"></span> <span data-i18n="medium">Sedang</span></div>
                        </div>
                    </div>

                    <!-- Tipe Legend -->
                    <div id="legendTipe" class="legend-layer">
                        <div class="legend-layer-title" data-i18n="type">Tipe</div>
                        <div class="legend-items">
                            <div class="legend-item"><i class="fa-solid fa-landmark" style="color:#6366f1"></i> <span
                                    data-i18n="government">Pemerintahan</span></div>
                            <div class="legend-item"><i class="fa-solid fa-school" style="color:#0ea5e9"></i> <span
                                    data-i18n="education">Pendidikan</span></div>
                            <div class="legend-item"><i class="fa-solid fa-hospital" style="color:#ef4444"></i> <span
                                    data-i18n="hospital">Rumah Sakit</span></div>
                        </div>
                    </div>

                    <!-- Wisata Legend -->
                    <div class="legend-layer" id="legendWisata">
                        <div class="legend-layer-title" data-i18n="tourist">Wisata</div>
                        <div class="legend-items">
                            <div class="legend-item"><span class="dot wisata"></span> <span
                                    data-i18n="tourist">Wisata</span></div>
                        </div>
                    </div>

                    <!-- KRB Legend -->
                    <div id="legendKRB" class="legend-layer">
                        <div class="legend-layer-title" data-i18n="krbTsunami">KRB Tsunami</div>
                        <div class="legend-items">
                            <div class="legend-item"><span class="dot" style="background:#dc2626"></span> <span
                                    data-i18n="veryHigh">Sangat Tinggi</span></div>
                            <div class="legend-item"><span class="dot" style="background:#f97316"></span> <span
                                    data-i18n="high">Tinggi</span></div>
                            <div class="legend-item"><span class="dot" style="background:#eab308"></span> <span
                                    data-i18n="medium">Sedang</span></div>
                            <div class="legend-item"><span class="dot" style="background:#22c55e"></span> <span
                                    data-i18n="low">Rendah</span></div>
                            <div class="legend-item"><span class="dot" style="background:#1d4ed8"></span> <span
                                    data-i18n="veryLow">Sangat Rendah</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- LAYER PANEL OVERLAY -->
            <div class="layer-toggle" id="layerToggle">
                <i class="fa-solid fa-layer-group"></i>
            </div>
            <div class="layer-panel collapsed" id="layerPanel">
                <div class="layer-header" id="layerClose">
                    <i class="fa-solid fa-layer-group"></i> <span data-i18n="layer">Layer</span>
                    <i class="fa-solid fa-xmark layer-close-icon"></i>
                </div>
                <div class="layer-list">
                    <!-- BASEMAP -->
                    <div class="layer-section">
                        <div class="layer-section-title" data-i18n="basemap">Peta Dasar</div>
                        <label class="layer-item"><input type="radio" name="basemap" value="osm" checked> ğŸ—ºï¸
                            OpenStreetMap</label>
                        <label class="layer-item"><input type="radio" name="basemap" value="satellite"> ğŸ›°ï¸
                            Satellite</label>
                        <label class="layer-item"><input type="radio" name="basemap" value="topo"> ğŸ”ï¸
                            Topography</label>
                    </div>

                    <!-- KRB TSUNAMI -->
                    <label class="layer-item"><input type="checkbox" id="chkKrb" checked> ğŸŒŠ <span
                            data-i18n="krbTsunami">KRB Tsunami</span></label>

                    <!-- TPD -->
                    <div class="layer-section">
                        <label class="layer-item layer-parent"><input type="checkbox" id="chkTPDAll"> ğŸ  <span
                                data-i18n="tpd">Tempat Pengungsian Darurat</span></label>
                        <div class="layer-children">
                            <label class="layer-item"><input type="checkbox" id="chkShelterMerah"> ğŸ”´ <span
                                    data-i18n="tpdMedium">Zona Merah</span></label>
                            <div class="layer-desc" data-i18n="tpdMediumDesc">Waspada! Area berlindung untuk tingkat
                                tsunami rendah</div>
                            <label class="layer-item"><input type="checkbox" id="chkShelterKuning"> ğŸŸ¡ <span
                                    data-i18n="tpdLow">Zona Kuning</span></label>
                            <div class="layer-desc" data-i18n="tpdLowDesc">Aman namun tetap waspada</div>
                            <label class="layer-item"><input type="checkbox" id="chkShelterHijau"> ğŸŸ¢ <span
                                    data-i18n="tpdSafe">Zona Hijau</span></label>
                            <div class="layer-desc" data-i18n="tpdSafeDesc">Area berlindung yang AMAN</div>
                        </div>
                    </div>

                    <!-- OTHER LAYERS -->
                    <label class="layer-item"><input type="checkbox" id="chkWisata"> ğŸ–ï¸ <span
                            data-i18n="tourist">Wisata</span></label>
                    <label class="layer-item"><input type="checkbox" id="chkLabels"> ğŸ·ï¸ <span
                            data-i18n="labels">Label</span></label>
                    <label class="layer-item"><input type="checkbox" id="chkBuffer"> ğŸ“ <span data-i18n="buffer">Buffer
                            2km</span></label>
                </div>
            </div>

            <div class="info" id="infoRute" style="display:none;">
                <h4><i class="fa-solid fa-circle-nodes"></i> Info Rute</h4>
                <div class="kv"><span>Dari</span><b id="infoFrom">-</b></div>
                <div class="kv"><span>Ke</span><b id="infoTo">-</b></div>
                <div class="kv"><span>Jarak</span><b id="infoDist">-</b></div>
                <div class="kv"><span>Durasi</span><b id="infoTime">-</b></div>
                <div class="kv"><span>Zona tujuan</span><b id="infoElev">-</b></div>
                <div style="margin-top:10px;">
                    <small><b>Instruksi (OSRM)</b> â€“ kalau OSRM tidak bisa, sistem fallback garis lurus.</small>
                    <div class="steps" id="steps"></div>
                </div>
            </div>

            <div class="coords" id="coords">Lat: -, Lng: -</div>
        </div>
    </div>

    <!-- MODALS -->
    <div class="modal" id="modalAbout">
        <div class="modal-card">
            <div class="modal-head">
                <h2>ğŸ“Œ Tentang WebGIS</h2>
                <button class="btn light" id="closeAbout"><i class="fa-solid fa-xmark"></i> Tutup</button>
            </div>
            <div class="modal-body">
                WebGIS ini menampilkan <b>Tempat Pengungsian Darurat (TPD) tsunami</b> dan <b>objek wisata</b> di Bali,
                serta menghitung <b>jalur evakuasi mengikuti jalan</b> menggunakan OSRM.
                <ul>
                    <li>TPD dikategorikan berdasarkan zona jarak dari pantai:</li>
                    <li>ğŸŸ¢ <b>Zona Aman</b>: 3-5 km dari pantai (lokasi tinggi & aman)</li>
                    <li>ğŸŸ¡ <b>Zona Rendah</b>: 1.5-3 km dari pantai (potensi rendah)</li>
                    <li>ğŸ”´ <b>Zona Sedang</b>: 1-1.5 km dari pantai (mungkin tergenang)</li>
                    <li>Tipe fasilitas: ğŸ›ï¸ <b>Pemerintahan</b>, ğŸ« <b>Pendidikan</b>, ğŸ¥ <b>Rumah Sakit</b></li>
                    <li>Semua TPD berada pada ketinggian lebih dari 10m.</li>
                    <li>Rute real jalan: walking/driving (pilih di toolbar).</li>
                    <li>Export CSV/GeoJSON untuk analisis lanjut (QGIS/ArcGIS).</li>
                </ul>
            </div>
            <div class="modal-foot">
                <button class="btn primary" id="okAbout"><i class="fa-solid fa-check"></i> Oke</button>
            </div>
        </div>
    </div>

    <div class="modal" id="modalHelp">
        <div class="modal-card">
            <div class="modal-head">
                <h2>ğŸ§­ Bantuan Singkat</h2>
                <button class="btn light" id="closeHelp"><i class="fa-solid fa-xmark"></i> Tutup</button>
            </div>
            <div class="modal-body">
                <b>Langkah cepat:</b>
                <ul>
                    <li>Pilih <b>Start</b> (wisata / koordinat / klik peta).</li>
                    <li>Klik <b>Auto Terdekat</b> (rekomendasi tujuan) atau pilih tujuan manual.</li>
                    <li>Klik <b>Hitung Rute</b>.</li>
                    <li>Aktifkan <b>Buffer 2 km</b> jika perlu.</li>
                </ul>
                <b>Catatan:</b> OSRM butuh internet. Jika gagal, rute otomatis pakai garis lurus.
            </div>
            <div class="modal-foot">
                <button class="btn primary" id="okHelp"><i class="fa-solid fa-check"></i> Mengerti</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text" id="loadingText">Memuat data...</div>
        </div>
    </div>

    <!-- Vendor JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>

    <!-- App JS -->
    <script src="app.js"></script>
</body>

</html>